<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="carpoolSQL">
<!-- 	<select id="carpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo"> -->
<!-- 		select C.*, M.*  -->
<!-- 		from carpool C, member M -->
<!-- 		where C.mno = M.mno -->
<!-- 		and category=#{category} -->
<!-- 		order by carno desc -->
<!-- 	</select> -->
	
<!-- 	<insert id="write"> -->
<!-- 		insert into carpool(carno, category, mno, departure, arrival, usertype, memo, departuredate, seat, price, stop1, stop2, stop3, stop4, stop5, smoking, genderlimit) -->
<!-- 		values(car_seq.nextval, #{category}, #{mno}, #{departure}, #{arrival}, #{usertype}, #{memo}, #{departuredate}, #{seat}, #{price}, #{stop1}, #{stop2}, #{stop3}, #{stop4}, #{stop5}, #{smoking}, #{genderlimit}) -->
<!-- 	</insert> -->
	
	
	<insert id="write" parameterType="com.gogo.withgo.vo.CarpoolVo">
    	insert into carpool(carno, category, mno, departure, arrival, usertype, memo, departuredate, seat, price, pricerange, stop1, stop2, stop3, smoking, genderlimit)
		values(car_seq.nextval, #{category}, #{mno}, #{departure}, #{arrival}, #{usertype}, #{memo}, #{departuredate}, #{seat}, #{price}, #{pricerange}, #{stop1}, #{stop2}, #{stop3}, #{smoking}, #{genderlimit})
   		<selectKey resultType="int" keyProperty="carno" order="AFTER">
   			 SELECT car_seq.currval from dual
   		</selectKey>
	</insert> 
	
	<select id="total" resultType="int">
		select count(*) from carpool where category=#{category}
	</select>

	
	
<!-- 	<select id="carpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo"> -->
<!-- 		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark  -->
<!-- 		from carpool C, member M -->
<!-- 		where C.mno = M.mno -->
<!-- 		and category=#{category}	 -->
<!-- 	</select> -->
	<select id="carpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select BB.* from (select AA.*, rownum rn from
		(select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking, C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno
		and category=#{category} order by carno) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
	</select>
	
	
	
	
<!-- 	<select id="searchAllList" resultType="com.gogo.withgo.vo.CarpoolMemberVo"> -->
<!-- 		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark  -->
<!-- 		from carpool C, member M -->
<!-- 		where C.mno = M.mno and  -->
<!-- 		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival})  -->
<!-- 		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival}) -->
<!-- 		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival}) -->
<!-- 		or (stop3=#{departure} and arrival=#{arrival})) -->
<!-- 	</select> -->
	<select id="searchAllList" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select BB.* from (select AA.*, rownum rn from
		(select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail,  (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno and 
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))) AA) BB
		where rn between #{bottomNum} and #{topNum}
	</select>	




	<select id="searchAllTotal" resultType="int">
		select count(*)
		from carpool C, member M
		where C.mno = M.mno and 
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	
	
	
	<select id="read" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*
		from carpool C, member M
		where C.mno = M.mno 
		and carno=#{carno}
	</select>
	
	<insert id="addBookMark">
		insert into bookmark(bmno, mno, carno)
		values(bm_seq.nextval, #{mno}, #{carno})
	</insert>
	
	<delete id="delBookMark">
		delete from bookmark
		where mno=#{mno} and carno=#{carno}
	</delete>
	
	
	
<!-- 	<select id="getBookMarks" resultType="com.gogo.withgo.vo.BookmarkInfoVo"> -->
<!-- 		 select BM.*, M.*, C.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark  -->
<!-- 		from bookmark BM, member M, carpool C -->
<!-- 		where BM.carno = C.carno -->
<!-- 		and C.mno = M.mno -->
<!-- 		and BM.mno=#{mno} -->
<!-- 	</select> -->
	<select id="getBookMarks" resultType="com.gogo.withgo.vo.BookmarkInfoVo">
		select BB.* from (select AA.*, rownum rn from (select BM.bmno, BM.bmdate, C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from bookmark BM, member M, carpool C
		where BM.carno = C.carno
		and C.mno = M.mno
		and BM.mno=#{mno}) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
		
		
	</select>



	
	<select id="myRegCarpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo">		
		select BB.* from (select AA.*, rownum rn from (select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail 
		from carpool C, member M
		where C.mno = M.mno
		and C.mno = #{mno}
		order by carno desc) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
	</select>


	
	<select id="reglistTotal" resultType="int">
		select count(*)
		from carpool C, member M
		where C.mno = M.mno
		and C.mno = #{mno}
	</select>
	
	
	<select id="bookmarkTotal" resultType="int">
		select count(*)
		from bookmark BM, member M, carpool C
		where BM.carno = C.carno
		and C.mno = M.mno
		and BM.mno=#{mno}
	</select>
	
	<select id="searchTotal1" resultType="int">
		select count(*)
		from carpool C, member M
		where C.mno = M.mno and 
		category=#{category} and
		genderlimit=#{genderlimit} and
		smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	<select id="searchTotal2" resultType="int">
		select count(*)
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit} 
		and pricerange=#{pricerange}<!--  -->
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	<select id="searchTotal3" resultType="int">
		select count(*)
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit}
		and usertype=#{usertype}<!--  --> 
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	<select id="searchTotal4" resultType="int">
		select count(*)
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit}
		and usertype=#{usertype}
		and pricerange=#{pricerange}
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	
	
	
<!-- 	<select id="search1" resultType="com.gogo.withgo.vo.CarpoolMemberVo"> -->
<!-- 		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark  -->
<!-- 		from carpool C, member M -->
<!-- 		where C.mno = M.mno and  -->
<!-- 		category=#{category} and -->
<!-- 		genderlimit=#{genderlimit} and -->
<!-- 		smoking=#{smoking} and -->
<!-- 		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival})  -->
<!-- 		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival}) -->
<!-- 		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival}) -->
<!-- 		or (stop3=#{departure} and arrival=#{arrival}))	 -->
<!-- 	</select> -->
	<select id="search1" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select BB.* from (select AA.*, rownum rn from (select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno and 
		category=#{category} and
		genderlimit=#{genderlimit} and
		smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))	) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
	</select>

	<select id="search2" resultType="com.gogo.withgo.vo.CarpoolMemberVo">	
		select BB.* from (select AA.*, rownum rn from (select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit} 
		and pricerange=#{pricerange}
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
	</select>

	<select id="search3" resultType="com.gogo.withgo.vo.CarpoolMemberVo">		
		select BB.* from (select AA.*, rownum rn from (select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit} 
		and usertype=#{usertype}<!--  --> 
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
	</select>
	
	<select id="search4" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select BB.* from (select AA.*, rownum rn from (select C.carno, C.category, C.mno, C.departure, C.arrival, C.usertype, C.memo, C.departuredate, C.seat, C.stop1, C.stop2, C.stop3, C.price, C.smoking,C.genderlimit, C.bookedseat, C.requestseat, M.email,  M.pw, M.nickname, M.name, M.phone, M.birth, M.gender, M.hascar, M.image, M.jdate, M.profile, M.auth, M.authphone, M.authemail, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit} 
		and usertype=#{usertype} 
		and pricerange=#{pricerange}
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))) AA) BB
		where rn between #{bottomNum} and #{topNum} order by rn desc
	</select>
	
</mapper>