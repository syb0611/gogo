<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="carpoolSQL">
<!-- 	<select id="carpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo"> -->
<!-- 		select C.*, M.*  -->
<!-- 		from carpool C, member M -->
<!-- 		where C.mno = M.mno -->
<!-- 		and category=#{category} -->
<!-- 		order by carno desc -->
<!-- 	</select> -->
	
<!-- 	<insert id="write"> -->
<!-- 		insert into carpool(carno, category, mno, departure, arrival, usertype, memo, departuredate, seat, price, stop1, stop2, stop3, stop4, stop5, smoking, genderlimit) -->
<!-- 		values(car_seq.nextval, #{category}, #{mno}, #{departure}, #{arrival}, #{usertype}, #{memo}, #{departuredate}, #{seat}, #{price}, #{stop1}, #{stop2}, #{stop3}, #{stop4}, #{stop5}, #{smoking}, #{genderlimit}) -->
<!-- 	</insert> -->
	
	
	<insert id="write" parameterType="com.gogo.withgo.vo.CarpoolVo">
    	insert into carpool(carno, category, mno, departure, arrival, usertype, memo, departuredate, seat, price, stop1, stop2, stop3, smoking, genderlimit)
		values(car_seq.nextval, #{category}, #{mno}, #{departure}, #{arrival}, #{usertype}, #{memo}, #{departuredate}, #{seat}, #{price}, #{stop1}, #{stop2}, #{stop3}, #{smoking}, #{genderlimit})
   		<selectKey resultType="int" keyProperty="carno" order="AFTER">
   			 SELECT car_seq.currval from dual
   		</selectKey>
	</insert> 
	
	<select id="carpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno
		and category=#{category}	
	</select>
	
	<select id="searchAllList" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno and 
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
		
	</select>
	
	<select id="read" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*
		from carpool C, member M
		where C.mno = M.mno 
		and carno=#{carno}
	</select>
	
	<insert id="addBookMark">
		insert into bookmark(bmno, mno, carno)
		values(bm_seq.nextval, #{mno}, #{carno})
	</insert>
	
	<delete id="delBookMark">
		delete from bookmark
		where mno=#{mno} and carno=#{carno}
	</delete>
	
<!-- 	<select id="getBookMarks" resultType="com.gogo.withgo.vo.BookmarkInfoVo"> -->
<!-- 		select BM.*, M.*, C.* -->
<!-- 		from bookmark BM, member M, carpool C -->
<!-- 		where BM.carno = C.carno -->
<!-- 		and C.mno = M.mno -->
<!-- 		and BM.mno=#{mno} -->
<!-- 	</select> -->
	
	
	<select id="getBookMarks" resultType="com.gogo.withgo.vo.BookmarkInfoVo">
		 select BM.*, M.*, C.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from bookmark BM, member M, carpool C
		where BM.carno = C.carno
		and C.mno = M.mno
		and BM.mno=#{mno}
	</select>
	
	<select id="myRegCarpoolList" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.* 
		from carpool C, member M
		where C.mno = M.mno
		and C.mno = #{mno}
		order by carno desc
	</select>
	
	<select id="search1" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno and 
		category=#{category} and
		genderlimit=#{genderlimit} and
		smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
		
	</select>
	
	<select id="search2" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit} 
		and pricerange=#{pricerange}<!--  -->
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	
	<select id="search3" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit}
		and usertype=#{usertype}<!--  --> 
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	
	<select id="search4" resultType="com.gogo.withgo.vo.CarpoolMemberVo">
		select C.*, M.*, (select count(*) from bookmark where bookmark.carno=C.carno and mno=#{mno}) bookmark 
		from carpool C, member M
		where C.mno = M.mno 
		and category=#{category} 
		and genderlimit=#{genderlimit}
		and usertype=#{usertype}
		and pricerange=#{pricerange}
		and smoking=#{smoking} and
		((departure=#{departure} and arrival=#{arrival}) or (departure=#{departure} and stop1=#{arrival}) or (departure=#{departure} and stop2=#{arrival}) or (departure=#{departure} and stop3=#{arrival}) 
		or (stop1=#{departure} and stop2=#{arrival}) or (stop1=#{departure} and stop3=#{arrival}) or (stop1=#{departure} and arrival=#{arrival})
		or (stop2=#{departure} and stop3=#{arrival}) or (stop2=#{departure} and arrival=#{arrival})
		or (stop3=#{departure} and arrival=#{arrival}))
	</select>
	
</mapper>